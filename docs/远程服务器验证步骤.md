# 远程 Windows 服务器验证步骤

## 验证目标

在干净的 Windows 服务器上测试打包后的 exe 是否可以直接运行（无需 Python 环境和额外安装）。

## 前置准备

### 1. 准备验证文件

需要上传到服务器的文件：
- `dist/LabClassificationService.exe` - 打包后的主程序
- `scripts/check_dependencies.py` - 依赖检查脚本（可选，用于详细诊断）

### 2. 上传文件到服务器

可以使用以下方式之一：

**方式A：使用 RDP（远程桌面）**
1. 连接远程桌面：`mstsc`
2. 输入服务器 IP：`119.91.36.69`
3. 用户名：`Administrator`
4. 登录后，将文件拖拽或复制到服务器

**方式B：使用 FTP/SFTP**
- 使用 FileZilla 等工具上传文件

**方式C：使用 PowerShell Remoting**
```powershell
# 在本地 PowerShell 中执行
$session = New-PSSession -ComputerName 119.91.36.69 -Credential (Get-Credential)
Copy-Item -Path "dist\LabClassificationService.exe" -Destination "C:\temp\" -ToSession $session
```

## 验证步骤

### 步骤1：连接服务器并检查环境

1. **远程桌面连接到服务器**
2. **检查 Python 环境**（应该没有或已卸载）
   ```cmd
   python --version
   ```
   如果提示"不是内部或外部命令"，说明没有 Python，这是理想的测试环境

3. **检查 Visual C++ 运行时**
   ```cmd
   dir "C:\Windows\System32\MSVCR140.dll"
   dir "C:\Windows\System32\VCRUNTIME140.dll"
   ```
   如果文件不存在，说明可能缺少运行时（这正好是我们想测试的情况）

### 步骤2：运行 exe 进行测试

1. **上传 exe 到服务器**
   - 将 `LabClassificationService.exe` 复制到服务器（如 `C:\temp\` 或桌面）

2. **直接运行 exe**
   ```cmd
   cd C:\temp
   LabClassificationService.exe
   ```

3. **观察结果**

   **情况A：成功启动**
   - 控制台显示 `INFO: Uvicorn running on http://0.0.0.0:8000`
   - 没有 DLL 缺失错误
   - ✅ **验证通过！可以直接分发**

   **情况B：DLL 缺失错误**
   ```
   错误示例：
   - "无法启动此应用程序，因为计算机中丢失 VCRUNTIME140.dll"
   - "找不到 MSVCR140.dll"
   - "应用程序无法正常启动(0xc000007b)"
   ```
   - ⚠️ **需要安装 Visual C++ Redistributable**

### 步骤3：测试功能（如果启动成功）

1. **在服务器上打开浏览器**
   - 访问：`http://localhost:8000`
   - 应该能看到前端页面

2. **测试 API**
   - 尝试进行一次聚类操作
   - 验证功能是否正常

### 步骤4：如果需要安装运行时

如果出现 DLL 缺失错误，安装 Visual C++ Redistributable：

**下载并安装：**
1. 下载：https://aka.ms/vs/17/release/vc_redist.x64.exe
2. 在服务器上运行安装程序
3. 重新测试 exe

**验证安装后：**
- 再次运行 exe，应该可以正常启动
- 如果成功，说明运行时是必需的依赖

## 验证结果记录

| 测试项 | 结果 | 备注 |
|--------|------|------|
| Python 环境 | ☐ 无 / ☐ 有 | 理想情况下应该无 |
| C++ 运行时 | ☐ 有 / ☐ 无 | |
| exe 启动 | ☐ 成功 / ☐ 失败 | |
| DLL 错误 | ☐ 无 / ☐ 有（列出具体 DLL）| |
| 前端访问 | ☐ 正常 / ☐ 异常 | |
| 功能测试 | ☐ 正常 / ☐ 异常 | |

## 结论

- **如果直接运行成功**：✅ exe 可以独立分发，不需要额外环境
- **如果需要安装 C++ 运行时**：⚠️ 需要在分发说明中告知用户，或创建安装包自动安装

## 安全提示

⚠️ **重要**：验证完成后，建议：
1. 修改服务器密码
2. 不要在生产环境保留这些凭据
3. 验证完成后及时断开连接

